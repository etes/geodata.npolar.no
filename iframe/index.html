<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta name="viewport" content="initial-scale=1, maximum-scale=1,user-scalable=no"/>
		<title>Svalbardkartet IFrame Designer</title>
		<link rel="stylesheet" type="text/css" href="http://js.arcgis.com/3.6/js/dojo/dijit/themes/claro/claro.css">
		<link rel="stylesheet" type="text/css" href="css/ExpandoPane.css">
		<link rel="stylesheet" type="text/css" href="http://js.arcgis.com/3.6/js/esri/css/esri.css" />
		<link rel="stylesheet" type="text/css" href="agsjs/css/agsjs.css" />
		<style>
			html, body {
				height: 100%;
				width: 100%;
				margin: 0;
				padding: 0px;
				font-family: helvetica, arial, sans-serif;
				font-size: 90%;
			}

			#rightPane{
				width: 200px;
				overflow: auto
			}
			#showhide{
			/*-moz-user-select: -moz-none;-khtml-user-select: none;-webkit-user-select: none;user-select: none;*/
        -moz-border-radius: 5px; -webkit-border-radius: 5px; -o-border-radius: 5px; border-radius: 5px;
        /*-moz-box-shadow: 0 0 0.5em black; -webkit-box-shadow: 0 0 0.5em black; -o-box-shadow: 0 0 0.5em black; box-shadow: 0 0 0.5em black;*/
			border: solid 2px #AAAAAA;
			background-color: #EEEEEE;
 			margin:0px;
			padding:0px;
			height:20px;
			position: fixed;
			top: 5px;
			right: 5px;
			width: 20px;
			z-index: 50;
			}
			
			#paramDiv{
			/*-moz-user-select: -moz-none;-khtml-user-select: none;-webkit-user-select: none;user-select: none;*/
        	-moz-border-radius: 5px; -webkit-border-radius: 5px; -o-border-radius: 5px; border-radius: 5px;
        	-moz-box-shadow: 0 0 0.5em black; -webkit-box-shadow: 0 0 0.5em black; -o-box-shadow: 0 0 0.5em black; box-shadow: 0 0 0.5em black;
			display:none;
 			margin:0px;
			padding:5px;
			width:auto;
			background-color: #FFFFFF;
			position: fixed;
			height:auto;
			right:5px;
			top:5px;
			z-index: 40;
			}
			#layersDiv{
				width: 400px;	
			}
/*
			.code {
				padding: 5px;
				font-size: 12px;
				border: solid 1px black;
				background-color: #DDDDDD;
				color: #222222;
				word-wrap: break-word;
				white-space: pre-wrap;
			}
			
			.buttonText{
        -moz-border-radius: 5px; -webkit-border-radius: 5px; -o-border-radius: 5px; border-radius: 5px;
			border: solid 2px #E0DFDF;
			background-color: #EEEEEE;
 			margin-top:10px;
			padding:2px;
			width: auto;
			}
			*/
			#divCode { 
        width: 400px; padding: 5px; overflow: auto;
        border: solid 2px #EEEEEE;
        background-color: #EEEEEE;
        font-family: monospace;
        word-wrap: break-word;
        white-space: pre-wrap;
        -moz-border-radius: 5px; -webkit-border-radius: 5px; -o-border-radius: 5px; border-radius: 5px;
        -moz-box-shadow: 0 0 0.5em black; -webkit-box-shadow: 0 0 0.5em black; -o-box-shadow: 0 0 0.5em black; box-shadow: 0 0 0.5em black;
      }

			/* this line hide layers when out of scale for the inline TOC */
			.agsjsTOCOutOfScale {
				/*    display: none; */
			}
			
			/*Esri zoom silder*/
.esriSimpleSlider {
	top: 5px;
	left: 8px;
	border: none !important;
	background-color: transparent !important;
	color: white !important;
	box-shadow: none !important;
	-webkit-box-shadow: none;
	-moz-box-shadow: none;
}

.esriSimpleSlider div {
	margin-top: 5px;
	margin-bottom: 5px;
	width: 20px;
	height: 20px;
	line-height: 18px;
	font-size: 18px;
}
	.esriSimpleSliderVertical .esriSimpleSliderIncrementButton,
	.esriSimpleSliderVertical .esriSimpleSliderDecrementButton {
	background: #858585;
	background: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/Pgo8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgdmlld0JveD0iMCAwIDEgMSIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSI+CiAgPGxpbmVhckdyYWRpZW50IGlkPSJncmFkLXVjZ2ctZ2VuZXJhdGVkIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjAlIiB5MT0iMCUiIHgyPSIwJSIgeTI9IjEwMCUiPgogICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iIzVkYWRkZCIgc3RvcC1vcGFjaXR5PSIxIi8+CiAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiMwMTdiYzIiIHN0b3Atb3BhY2l0eT0iMSIvPgogIDwvbGluZWFyR3JhZGllbnQ+CiAgPHJlY3QgeD0iMCIgeT0iMCIgd2lkdGg9IjEiIGhlaWdodD0iMSIgZmlsbD0idXJsKCNncmFkLXVjZ2ctZ2VuZXJhdGVkKSIgLz4KPC9zdmc+);
	background: -moz-linear-gradient(top, #858585 0%, #242424 100%);
	background: -webkit-gradient(linear, left top, left bottom, color-stop(0%, #858585), color-stop(100%, #242424));
	background: -webkit-linear-gradient(top, #858585 0%, #242424 100%);
	background: -o-linear-gradient(top, #858585 0%, #242424 100%);
	background: -ms-linear-gradient(top, #858585 0%, #242424 100%);
	background: linear-gradient(top, #858585 0%, #242424 100%);	
	border: solid 1px #545454;
	-webkit-border-radius: 4px;
	-moz-border-radius: 4px;
	border-radius: 4px;
	box-shadow: 0 0 0.25em #BBB;
}

		</style>
		<script type="text/javascript">
            var djConfig = {
                parseOnLoad : true,
                packages : [{
                    "name" : "agsjs",
                    //if you want to host on your own server, download from
                    //http://gmaps-utility-gis.googlecode.com/svn/tags/agsjs/
                    // and put in folders then use path like:
                    //"location": location.pathname.replace(/\/[^/]+$/, '') + '/../src/agsjs'
                    // use /src/ for debug and /build/ for production.
                    // you can also use online version using the following location,
                    // however please noted googlecode.com is not a true CDN and is not fast and may not be available.
                    // also, it is recommended to use a particular version from /tags/agsjs/<version>/
                    // in a production app to avoid unexpected results.
                    //"location": "http://gmaps-utility-gis.googlecode.com/svn/tags/agsjs/2.06/build/agsjs"
                    //"location": "http://gmaps-utility-gis.googlecode.com/svn/tags/agsjs/latest/build/agsjs"
                    //"location": "http://gmaps-utility-gis.googlecode.com/svn/trunk/agsjs/build/agsjs"
                    "location" : location.pathname.replace(/\/[^/]+$/, '') + '/agsjs'
                }]
            };

		</script>
		<script src="http://serverapi.arcgisonline.com/jsapi/arcgis/3.5/"></script>
		<script type="text/javascript">
            dojo.require("dijit.layout.BorderContainer");
            dojo.require("dijit.layout.ContentPane");
            //dojo.require('dijit.form.CheckBox');
            dojo.require("esri.map");
            dojo.require("esri.dijit.Popup");
            dojo.require("esri.layers.FeatureLayer");
            dojo.require("dojox.html.entities");
            dojo.require("agsjs.dijit.TOC");
            dojo.require("dojox.layout.ExpandoPane");  
		</script>
		<script type="text/javascript">
		        
   	        var layers = [{ name: 'HvalrossLiggeplasser', id: 2 }, { name: 'RÃ¸ye', id: 3 }, { name: 'SjÃ¸fugl kolonier', id: 5 }, { name: 'Alle SjÃ¸pattdyr observasjoner', id: 27 }, { name: 'IsbjÃ¸rn observasjoner', id: 37 }, { name: 'Strandrydding per Ã¥r', id: 58 }, { name: 'ReinbestandomrÃ¥der', id: 59 }, { name: 'Biogeografiske soner', id: 60 }, { name: 'Vegetasjon (10 kasser)', id: 62}, { name: 'Geologi', id: 94 }];
   	        var root = location.protocol + "//" + location.host;
   	        var mapletUrl = root + "/iframe/embed.html"; // Relative path to Iframe page, should be absolute path when deployed, for example http://svalbardkartet.npolar.no/iframe.html
   	        var previewURL = 'preview.html'; // Relative path, should be absolute path when deployed.
   	        var basemapServiceUrl = 'http://geodata.npolar.no/ArcGIS/rest/services/inspire1/NP_TopoNordomr_U33_CHL/MapServer';
   	        var dynamicServiceUrl = 'http://willem3.npolar.no/arcgis/rest/services/Svalbard/embed/MapServer';
   	        var geometryServiceUrl = 'http://geodata.npolar.no/ArcGIS/rest/services/geometry/Geometry/GeometryServer';
   	        var isTiledMap = true;
   	        //var isTiledMap = false;
   	        //@TODO add map popup and feature info function
   	        var decimalPlacesWGS84 = 6;
   	        var overlayMap, point, mode, symbolCross, symbolDot, geometryService;
      
      
            var map, toc, dynaLayer1, dynaLayer2, featLayer1;
            var layerInfo = [];
            var visible = [];
            var identifyTask, identifyParams, identifyHandle = 0;
            var opacityValue = 0.8;
            function init(){
            	
            // hideable panel
		document.getElementById("paramDiv").style.display = "block";
		document.getElementById("showhide").style.display = "block";
		
          geometryService = new esri.tasks.GeometryService(geometryServiceUrl);
          dojo.connect(geometryService, "onProjectComplete", onProjectComplete);
          
          //setup the popup window 
        var popup = new esri.dijit.Popup({
          fillSymbol: new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID, new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID, new dojo.Color([255, 0, 0]), 2), new dojo.Color([255, 255, 0, 0.25]))
        }, dojo.create("div"));
            
              var initialExtent = new esri.geometry.Extent({ "xmin": 356350.3184, "ymin": 8456631.06, "xmax" : 886026.044, "ymax" : 8989694.055, "spatialReference": { "wkid": 32633} });
              map = new esri.Map("map", {
                extent: initialExtent,
                infoWindow: popup,
                logo: false
              });
                            
              var basemap = new esri.layers.ArcGISTiledMapServiceLayer(basemapServiceUrl);
              map.addLayer(basemap);
              
              dynaLayer1 = new esri.layers.ArcGISDynamicMapServiceLayer(dynamicServiceUrl, {
                opacity: 0.8
              });
              
              featLayer1 = new esri.layers.FeatureLayer("http://willem3.npolar.no/arcgis/rest/services/Svalbard/embed/MapServer/9", {
                mode: esri.layers.FeatureLayer.MODE_SNAPSHOT,
                outFields: ["Navn"]//,
              });
              
              featLayer1.setDefinitionExpression("STCOFIPS='21111'"); //
              var h = dojo.connect(map, 'onLayersAddResult', function(results){
                // overwrite the default visibility of service.
                // TOC will honor the overwritten value.
                dynaLayer1.setVisibleLayers([]);
                try {
                  toc = new agsjs.dijit.TOC({
                    map: map,
                    layerInfos: [
                    {
                      layer: dynaLayer1,
                      title: "Svalbardkartet",
                      //collapsed: false, // whether this root layer should be collapsed initially, default false.
                      slider: true, // whether to display a transparency slider. default false.
                      autoToggle: true //whether to automatically collapse when turned off, and expand when turn on for groups layers. default true. 
                    }]
                  }, 'tocDiv');
                  toc.startup();
                  dojo.connect(toc, 'onLoad', function(){
                    if (console) 
                      console.log('TOC loaded');
                    //dojo.byId("FindNodeByLayer").disabled = false;
                  });
                  dojo.disconnect(h);
                } catch (e) {
                  alert(e);
                }
              });
              
              map.addLayers([dynaLayer1]);
              

          symbolCross = new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_X, 15, new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID, new dojo.Color([0, 0, 0]), 2));
          symbolDot = new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE, 10, new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID, new dojo.Color([255, 0, 0]), 2), new dojo.Color([255, 0, 0]));
          dojo.connect(dojo.byId('btnPlaceMarker'), "onclick", btnPlaceMarker_click);
          dojo.connect(dojo.byId('btnCancelMarker'), "onclick", btnCancelMarker_click);
          dojo.connect(map, "onClick", map_click);
          dojo.connect(map, "onExtentChange", map_extentChanged);
          dojo.connect(dynaLayer1, "onOpacityChange", generateCode);
          dojo.connect(dojo.byId('btnRemoveMarker'), "onclick", btnRemoveMarker_click);
          dojo.connect(dojo.byId('btnGenerateCode'), "onclick", generateCode);
          dojo.connect(dojo.byId('btnExamplePage'), "onclick", btnExamplePage_click);
          dojo.connect(dojo.byId('txtWidth'), "onchange", generateCode);
          dojo.connect(dojo.byId('txtHeight'), "onchange", generateCode);
          dojo.connect(dojo.byId('rbLockedYes'), "onchange", generateCode);
          dojo.connect(dojo.byId('rbLockedNo'), "onchange", generateCode);
          dojo.connect(dojo.byId('rbSymbolCross'), "onchange", symbolChanged);
          dojo.connect(dojo.byId('rbSymbolDot'), "onchange", symbolChanged);
          dojo.connect(dojo.byId('chkSC'), 'onchange', generateCode);
          
          dojo.connect(map, "onClick", updateIdentifyTask);

                            
              //resize the map when the browser resizes - view the 'Resizing and repositioning the map' section in
              //the following help topic for more details http://help.esri.com/EN/webapi/javascript/arcgis/help/jshelp_start.htm#jshelp/inside_guidelines.htm      
              var resizeTimer;
              dojo.connect(map, 'onLoad', function(theMap){
              	initIdentify(map);
                dojo.connect(dijit.byId('map'), 'resize', function(){ //resize the map if the div is resized
                  clearTimeout(resizeTimer);
                  resizeTimer = setTimeout(function(){
                    map.resize();
                    map.reposition();
                  }, 500);
                });
              });
             
            } //end init
            
            
            // Iframe designer
            // get the checked layers
            function getCheckedLayers() {
                var result = [];
                getContent();
                //console.log(layerInfo);
                for (var i = 0; i < layerInfo.length; i++) {
                    var checkBox = dojo.byId('layercheckbox_' + i);
                    if (layerInfo[i] !== -1 && checkBox && checkBox.checked)
                        result.push(i);
                }
                return result;
                

            }

            function layerCheckBox_click(e) {
                var checkBox = e.target;
                var layer = map.getLayer(layers[1].id);
                if (layer) {
                    layer.setVisibleLayers(getCheckedLayers());
                    layer.visible = true;
                }
                //console.log(layers[1].id,getCheckedLayers());
                generateCode();

            }

            //layer infos
            function getContent() {
                //var url;

                url = dynamicServiceUrl;

                var requestHandle = esri.request({
                    "url" : dynamicServiceUrl,
                    "content" : {
                        "f" : "json"
                    },
                    "callbackParamName" : "callback",
                });
                requestHandle.then(requestSucceeded, requestFailed);
            }

            function requestSucceeded(response, io) {

                // dojo.toJson method converts the given JavaScript object
                // and its properties and values into simple text.
                dojo.toJsonIndentStr = "  ";

                // show layer indexes and names
                if (response.hasOwnProperty("layers")) {

                    layerInfo = dojo.map(response.layers, function(f) {
                        if (f.subLayerIds == null) {
                            return f.id;
                        } else {
                            return -1;
                        }
                    });
                } else {
                    // console.log ("no layers");
                }
            }

            function requestFailed(error, io) {
                console.log("Failed: ", error);
            }

            function btnPlaceMarker_click() {
                mode = "marker";
                dojo.attr('btnPlaceMarker', 'disabled', 'disabled');
                dojo.removeAttr('btnCancelMarker', 'disabled');
            }

            function btnCancelMarker_click() {
                mode = "default";
                dojo.attr('btnCancelMarker', 'disabled', 'disabled');
                dojo.removeAttr('btnPlaceMarker', 'disabled');
            }

            function btnRemoveMarker_click() {
                mode = "default";
                map.graphics.clear();
                point = null;
                dojo.attr('btnRemoveMarker', 'disabled', 'disabled');
                dojo.attr('btnCancelMarker', 'disabled', 'disabled');
                dojo.removeAttr('btnPlaceMarker', 'disabled');
                generateCode();
                dojo.byId('utm33Ncoords').innerHTML = "";
                dojo.byId('wgs84coords').innerHTML = "";
            }

            function btnExamplePage_click() {
                var w = window.open(previewURL, '_blank', null, false);
                if (!(w))
                    alert('You need to turn off pop-up blockers to open the sample page.');
            }

            function generateCode() {
                var checkedLayers = getCheckedLayers();
                var code = dojo.string.substitute('<iframe scrolling="no" src="${url}?${sc}width=${width}&height=${height}&sym=${symbol}&extent=${extent}&wkid=32633${point}&mapUrl=${mapUrl}${overlay}&t=${tiled}&n=${nav}&opValue=${opValue}" width="${width}" height="${height}"></iframe>', {
                    url : mapletUrl,
                    // @TODO show marker coordinates on map
                    sc : dojo.byId('chkSC').checked ? "sc=0&" : "",
                    extent : Math.round(map.extent.xmin) + "," + Math.round(map.extent.ymin) + "," + Math.round(map.extent.xmax) + "," + Math.round(map.extent.ymax),
                    opValue: opacityValue,
                    width : dojo.byId('txtWidth').value,
                    height : dojo.byId('txtHeight').value,
                    point : ( point ? "&x=" + Math.round(point.x) + "&y=" + Math.round(point.y) : ""),
                    nav : dojo.byId('rbLockedYes').checked ? "0" : "1",
                    symbol : dojo.byId('rbSymbolCross').checked ? "0" : "1",
                    tiled : isTiledMap ? "1" : "0",
                    mapUrl : encodeURIComponent(basemapServiceUrl),
                    overlay : checkedLayers.length == 0 ? "" : "&cl=" + checkedLayers.join(";")
                });
                dojo.byId('divCode').innerHTML = dojox.html.entities.encode(code);
                return code;
            }

            function map_click(e) {
                if (mode == "marker") {
                    point = e.mapPoint;
                    map.graphics.clear();
                    var sym = symbolDot;
                    if (dojo.byId('rbSymbolCross').checked)
                        sym = symbolCross;
                    map.graphics.add(new esri.Graphic(point, sym));
                    dojo.removeAttr('btnRemoveMarker', 'disabled');
                    generateCode();
                    dojo.byId('utm33Ncoords').innerHTML = dojo.string.substitute("UTM coordinates (zone 33N): ${0}, ${1}", [Math.round(point.x), Math.round(point.y)]);
                    geometryService.project(map.graphics.graphics, new esri.SpatialReference({
                        "wkid" : 32633
                    }));
                }
            }

            function symbolChanged() {
                var sym = symbolDot;
                if (dojo.byId('rbSymbolCross').checked)
                    sym = symbolCross;
                if (map.graphics.graphics[0])
                    map.graphics.graphics[0].setSymbol(sym);
                generateCode();
            }

            function onProjectComplete(graphics) {
                if (graphics && graphics.length == 1) {
                    var g = graphics[0];
                    dojo.byId('wgs84coords').innerHTML = dojo.string.substitute("Geographic coordinates (Lat, Long): ${1}, ${0}", [dojo.number.format(g.geometry.x, {
                        places : decimalPlacesWGS84
                    }), dojo.number.format(g.geometry.y, {
                        places : decimalPlacesWGS84
                    })]);
                }
            }

            function map_extentChanged() {
                generateCode();
            }

            function testChangeFeatureLayerRenderer() {
                //based on http://help.arcgis.com/EN/webapi/javascript/arcgis/jssamples/renderer_class_breaks.html
                var symbol = new esri.symbol.SimpleFillSymbol();
                symbol.setColor(new dojo.Color([150, 150, 150, 0.5]));
                var renderer = new esri.renderer.ClassBreaksRenderer(symbol, "POP07_SQMI");
                renderer.addBreak(0, 25, new esri.symbol.SimpleFillSymbol().setColor(new dojo.Color([56, 168, 0, 0.5])));
                renderer.addBreak(25, 75, new esri.symbol.SimpleFillSymbol().setColor(new dojo.Color([139, 209, 0, 0.5])));
                renderer.addBreak(75, 175, new esri.symbol.SimpleFillSymbol().setColor(new dojo.Color([255, 255, 0, 0.5])));
                renderer.addBreak(175, 400, new esri.symbol.SimpleFillSymbol().setColor(new dojo.Color([255, 128, 0, 0.5])));
                renderer.addBreak(400, Infinity, new esri.symbol.SimpleFillSymbol().setColor(new dojo.Color([255, 0, 0, 0.5])));
                featLayer1.setRenderer(renderer);
                featLayer1.redraw();
                toc.refresh();
            }

            function testSetVisibleLayersProgramatically() {
                dynaLayer1.setVisibleLayers([8, 17, 18, 19, 20])
            }

            function testInsertNewLayer() {
                if (dynaLayer2 == null) {
                    dynaLayer2 = new esri.layers.ArcGISDynamicMapServiceLayer("http://geodata.npolar.no/ArcGIS/rest/services/inspire3/Miljo/MapServer", {
                        opacity : 0.8
                    });
                    var h = dojo.connect(map, 'onLayerAddResult', function(result) {
                        toc.layerInfos.splice(1, 0, {
                            layer : dynaLayer2,
                            title : "DynamicMapServiceLayer2",
                            // collapsed: true, // whether this root layer should be collapsed initially, default false.
                            slider : true, // whether to display a transparency slider. default false.
                            autoToggle : true //whether to automatically collapse when turned off, and expand when turn on for groups layers. default true.
                        });
                        toc.refresh();
                        dojo.disconnect(h);
                    });
                    map.addLayer(dynaLayer2);
                }
            }

            function testFindNodeByLayer() {
                // 0 is the layerId of group "Basis"
                toc.findTOCNode(dynaLayer1, 0).collapse();
                // 	12 is the id of layer "KortnebbgÃ¥s"
                toc.findTOCNode(dynaLayer1, 12).hide();
            }
            
            
            // Identify Task (PopUp)
            
            function initIdentify(map) {
        //create identify tasks and setup parameters 
        identifyTask = new esri.tasks.IdentifyTask("http://willem3.npolar.no/arcgis/rest/services/Svalbard/embed/MapServer");

        identifyParams = new esri.tasks.IdentifyParameters();
        identifyParams.tolerance = 5;
        identifyParams.returnGeometry = true;
        identifyParams.layerIds = getCheckedLayers();
        identifyParams.layerOption = esri.tasks.IdentifyParameters.LAYER_OPTION_VISIBLE;
        identifyParams.width = map.width;
        identifyParams.height = map.height;

        // Save a reference to the event listener so it can be
        // disconnected when no layers are selected
        identifyHandle = dojo.connect(map, "onClick", executeIdentifyTask);
      }
      
      function updateIdentifyTask() {
        visible = getCheckedLayers();
        // If no layers are visible set the array value to = -1
        // and disconnect the identify task
        if (visible.length === 0) {
          visible = [-1];
          dojo.disconnect(identifyHandle);
          map.infoWindow.hide();
          console.log('disconnected ID');
        } else if ( ! identifyHandle[0] ) { 
          // There are visible layers to re-connect identify task
          // and the identify task is not connected 
          identifyHandle = dojo.connect(map, "onClick", executeIdentifyTask);
          //console.log('connected ID');
        }
        // Update Identifys layers
        identifyParams.layerIds = visible;
      }
            
            function executeIdentifyTask(evt) {
        identifyParams.geometry = evt.mapPoint;
        identifyParams.mapExtent = map.extent;

        var deferred = identifyTask.execute(identifyParams);

        deferred.addCallback(function (response) {
          // response is an array of identify result objects    
          // return an array of features.
          return dojo.map(response, function (result) {
            var feature = result.feature;
            feature.attributes.layerName = result.layerName;
 
            var template = new esri.InfoTemplate();
            template.setTitle("${layerName}");
            template.setContent("${*}");
            feature.setInfoTemplate(template);

            return feature;
          });
        });

        map.infoWindow.setFeatures([deferred]);
        map.infoWindow.show(evt.mapPoint);
      }
      
            
            //show hide menu
			function showhide () {
				if(document.getElementById("paramDiv").style.display == "none") {
					document.getElementById("paramDiv").style.display = "block";
					document.getElementById("showhideImg").src = "/iframe/images/chevron_right.png";
				}
				else {
					document.getElementById("paramDiv").style.display = "none";
					document.getElementById("showhideImg").src = "/iframe/images/chevron_left.png";
					
				}
			}


            dojo.ready(init);
		</script>
	</head>
	<body class="claro">
		<div id="content" data-dojo-type="dijit.layout.BorderContainer" design="headline" gutters="false" style="width: 100%; height: 100%; margin: 0;">

			<div data-dojo-type="dojox.layout.ExpandoPane" data-dojo-props="duration:300, region:'left', maxWidth:'280px'" style="width:280px;" splitter="true">
				<div id="tocDiv"></div>

			</div>
			<div id="map" data-dojo-type="dijit.layout.ContentPane" region="center" style="padding:0px"></div>

				
    <div id="showhide" onclick="showhide();"><img id="showhideImg" src="/iframe/images/chevron_right.png" title="Show/hide toolbox" onmouseover="this.style.cursor='pointer'"></div>
				<div class="param" id="paramDiv">
					<div id="layersDiv" class="layersDiv">
						<div><strong>Embed Map in Website </strong> </div>
    <div style="padding: 5px">Select a layers to overlay and navigate to the desired map section.</div>
					</div>

					<div class="navigationdiv">
						Create static map (disable zooming and panning)
						<input id="rbLockedYes" name="rbLocked" type="radio" value="0"/>
						Yes
						<input id="rbLockedNo" name="rbLocked" type="radio" value="1" checked/>
						No.
					</div>
					<br />
					<div class="pointdiv">
						Add point marker to map.
						<div class="pointdivbuttons">
							<input id="btnPlaceMarker" value="Add point" type="button" />
							<input id="btnCancelMarker" value="Cancel" type="button" disabled="disabled" />
							<input id="btnRemoveMarker" value="Delete Marker" type="button" disabled="disabled" />
						</div>
						<div class="symboldiv">
							Symbol for marker
							<input id="rbSymbolCross" name="rbSymbol" type="radio" value="0"/>
							Cross
							<input id="rbSymbolDot" name="rbSymbol" type="radio" value="1" checked/>
							Circle
						</div>
						<div class="pointcoordinates"><div id="utm33Ncoords"></div><div id="wgs84coords"></div>
							<div class="showcoordinatediv"><input id="chkSC" name="chkSC" type="checkbox" checked="checked" /> Show marker coordinates on map </div>
						</div>
					</div>
					<div class="iframesizediv">
						<div class="widthdiv"><label for="txtWidth">Custom Width:</label><input id="txtWidth" type="text" value="500" /></div>
						<div class="heightdiv"><label for="txtHeight">Custom Height:</label><input id="txtHeight" type="text" value="500" /></div>
					</div>
					<br />
					<div id="codeDiv">
						<div class="code" id="divCode"></div>
						<div class="codefooter">
							Copy and paste above HTML code to embed on a website.
						</div>
						<div class="previewdiv">
							<input id="btnGenerateCode" value="Update Code" type="button" />
							<input id="btnExamplePage" value="Preview" type="button" /> (Opens in new page)
						</div>
					</div>
				</div>

			</div>
			<!--end parameters section
		</div>
		-->
	</body>
</html>
