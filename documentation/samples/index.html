<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Norwegian Polar Institute Maps API</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	
	<!-- Styles -->
	<link href="/css/bootstrap.min.css" rel="stylesheet">
	<link href="/css/bootstrap-responsive.min.css" rel="stylesheet">
	<link href="/css/app2.css" rel="stylesheet">
	<link href="/css/prettify.css" rel="stylesheet">
	<script src="/js/prettify.js" type="text/javascript"></script>
	<!--esri.css can be downloaded from http://serverapi.arcgisonline.com/jsapi/arcgis/3.4/js/esri/css/esri.css-->
	<link href="/css/esri.css" rel="stylesheet" type="text/css" >

</head>
<body data-spy="scroll" data-target=".bs-docs-sidebar">

	<!-- Load fallback css when there is no javascript -->
	<noscript>
		<link href="/css/fallback.css" media="screen" rel="stylesheet" type="text/css"/>
	</noscript>

	<!-- Subhead
	================================================== -->
	<header class="jumbotron subhead">
		<div class="container">
			<img src="img/np-logo.png" style="float:left">
			<h1>Norwegian Polar Institute Maps API<sup style="font-size:14px">Javascript </sup></h1>
		</div>
	</header>

	<div class="container">
		<!-- Docs nav
		================================================== -->
		<div class="row">
			<div class="span3 bs-docs-sidebar">
				<ul class="nav nav-list bs-docs-sidenav">
					<li>
						<a href="#getting_started"><i class="icon-chevron-right"></i>Getting started</a>
					</li>
					<li>
						<a href="#setting_the_map"><i class="icon-chevron-right"></i>Setting the map</a>
					</li>
					<li>
						<a href="#geocoding"><i class="icon-chevron-right"></i>Geocoding service</a>
					</li>
					<li>
						<a href="#overlays"><i class="icon-chevron-right"></i>Map Overlays</a>
					</li>
					<li>
						<a href="#layers"><i class="icon-chevron-right"></i>Layers</a>
					</li>
					<li>
						<a href="samples"><i class="icon-chevron-right"></i>Sample Codes</a>
					</li>
				</ul>
			</div>

			<div class="span9">

				<!-- Getting Started
				================================================== -->
				<section id="getting_started">
					<div class="page-header">
						<h2 >Getting Started</h2>
					</div>
					<h3><a name="overview"></a>Overview</h3>
					<p>NPI provides topographic maps of Svalbard and Jan Mayen served at <a href="http://geodata.npolar.no/arcgis/rest/services">geodata.npolar.no/arcgis/rest/services</a>. 
						These maps can be consumed through various client applications such as ArcGIS API for JavaScript, Google Maps API, OpenLayers etc. to easily create a mapping application. 
					</p>
					<p>This documentation shows how to quickly setup and develop an interactive web map application for the Svalbard region using ArcGIS API for Javascript, including adding place name search, working with map overlays and popups and dealing with map services.
						The ArcGIS API for JavaScript is a lightweight way to embed maps and tasks in web applications similar to Google Maps API with more advanced functionalities, such as geoprocessing, network analysis and data editing. 
					</p>
		
					<h3><a name="Audience"></a>Audience</h3>
					<p>This documentation is designed with the assumption that you are familiar with basic JavaScript programming and mapping concepts (such as Google Maps). 
						It's also desirable if you make yourself familiar with Esri’s <a href="http://help.arcgis.com/en/webapi/javascript/arcgis/">ArcGIS API for Javascript</a> to take full advantage of the mapping API. 
						</p>
				</section>

				<!-- Setting the map
				================================================== -->
				<section id="setting_the_map">
					<div class="page-header">
						<h2>Setting the map</h2>
					</div>
					<p>There are a few steps to follow in order to initialize a map in your web application:</p>
					<ol>
					  <li>Setup an HTML document and include esri.css style sheet in the head section of the document to have styles and various widgets for the map.
					  	<pre><code>&lt;link rel="stylesheet" href="http://serverapi.arcgisonline.com/jsapi/arcgis/3.5/js/esri/css/esri.css"/&gt;</code></pre>
					  </li>
					  <li>Add reference to the ArcGIS API for Javascript which loads all symbols and definitions needed for using the API.
					  	<pre><code>&lt;script src="http://serverapi.arcgisonline.com/jsapi/arcgis/3.5/"&gt;&lt;/script&gt;</code></pre>
					  </li>					  
					  <li>Create a <code>div</code> element with a certain id to hold the map. The size of the map is specified in the style attribute of the div.
					  	<pre><code>&lt;div id="map" style="width:100%; height:256px;"&gt;&lt;/div&gt;</code></pre>
					  	</li>
					  <li>Use another <code>&lt;script&gt;</code> tag to load the mapping modules from ArcGIS JavaScript API using the <code>dojo.require()</code> function.
					  	The initialize function creates a map instance using the <code>esri.Map</code> module and connects it with the DIV element created above by referencing it using the <code>"map"</code> id.
					  	<pre><code>&lt;script&gt;
dojo.require("esri.map");
function initialize() {
	// create map instance and add a basemap
	var map = new esri.Map("map");
	basemapURL = "http://geodata.npolar.no/ArcGIS/rest/services/inspire1/NP_TopoSvalbard_U33_CHL/MapServer"
	map.addLayer(new esri.layers.ArcGISTiledMapServiceLayer(basemapURL));
    }

    dojo.ready(initialize); 
&lt;/script&gt;</code></pre>
					  	
					  	Add a topographic basemap of Svalbard to the map by providing the cached <a href ="http://geodata.npolar.no/ArcGIS/rest/services/inspire1/NP_TopoSvalbard_U33_CHL/MapServer">map service REST URI</a>. <br />
					  	Finally, instruct the API to only execute the <code>initialize()</code> function after dependencies are fully loaded and the DOM is read, by passing <code>dojo.ready()</code>.
					  	</li>					  	
			      </ol>
			      <p><strong>That's it!</strong> You now have a working map of Svalbard.</p>
			      
					<div id="map1" style="width:100%; height:256px;"></div>
					<br />
			      <h4>Map Options</h4>
			      <p>At this stage, you didn't pass any optional parameters when creating the map instance and therefore the map is loaded with the default extent and zoom level. <br />
			      	Because we often want to center the map on a specific area, create an initialExtent object to hold the starting extent of the map and add it to the map instance created above.
			      	Use the <a href ="extenthelper.html">extent helper</a> to create your desired map extent coordinates in JSON.
			      	</p>
			       <pre><code>	var intialExtent = new esri.geometry.Extent ({<code id="strongCode">
		"Xmin": 477423.89,
		"Ymin": 8663685.98,
		"Xmax": 553624.05,
		"Ymax": 8714486.09,
		"spatialReference": {"wkid":32633}</code>
		});
	// create map instance and add a basemap
	var map = new esri.Map("map" <code id="strongCode">{extent: initialExtent}</code>);
</code></pre>
		      
					<p>By default the Esri logo is drawn to the bottom right of the map which can be turned off by:</p>
					<pre><code>	var map = new esri.Map("map" {extent: initialExtent,<code id="strongCode"> logo: false</code>});
</code></pre>
					
				</section>

				<!-- Geocoding Service
				================================================== -->
				<section id="geocoding">
					<div class="page-header">
						<h2>Geocoding Service (Search place name)</h2>
					</div>

					<p>
						Norwegian Polar Institute provides the <a target="_self" href="http://placenames.npolar.no/api">place names API</a> for looking up place names dynamically from user input.
						The search results can be used to convert place names  (e.g "Longyearbyen") into geographic coordinates	(e.g. latitude 78.22223 and longitude 15.631533), which you can use to
						place markers or position the map.
					</p>

					<h3 id="autocomplete">Autocomplete place names</h3>
					
					<p>The <a href="http://yuilibrary.com/yui/docs/autocomplete/">YUI autocomplete library</a> is used to dynamically search for place names as the user types in the input field. 
						As text is entered, the autocomplete returns place name predictions to the application in the form of a drop-down pick list which can be used to help users find and zoom to a specific location.</p>
					
					<p><strong>Requirements:</strong> Make sure you add reference the YUI library before creating the autocomplete instance.</p>
					<pre><code>&lt;script src="http://yui.yahooapis.com/3.10.1/build/yui/yui-min.js"&gt;&lt;/script&gt;</code></pre>
					<p>Next, create a new YUI instance for your application and populate it with the required modules by specifying them as arguments to the <code>YUI().use()</code> method.</p>
					<pre>&lt;script&gt;
// Create a new YUI instance and populate it with the required modules.
YUI().use("autocomplete", "autocomplete-filters", "autocomplete-highlighters", function(Y) {
    // AutoComplete is available and ready for use. Add implementation code here.
});
&lt;/script&gt;</pre>
					<p>
						You can use the placenames API within your code as results source via the <code>http://placenames.npolar.no:80</code> URL.					
						The results source contains the input terms and a callback method to execute upon receipt of the response.	
					</p>
					<p> The JSON response is an object in the following form:
						<pre>
{
location: "Svalbard",
title: "Longyearbyen",
terrain: "Bustad",
approved: true,
ident: "8560",
north: 78.22223,
link: "/stadnamn/Longyearbyen?ident=8560",
east: 15.631533,
newer_ident: ""
}
</pre>
					</p>
					<p>The fields are explained in the place names <a href="http://placenames.npolar.no/terreng">API</a>.			
					These fields can also be passed as parameter to narrow the search results.</p>
					<p>The example below restricts your autocomplete results to place names that are approved and within Svalbard:</p>
					<pre><code>
	// Create a new YUI instance and populate it with the required modules.
    YUI().use("autocomplete", "autocomplete-filters", "autocomplete-highlighters", function(Y) {
    	// Add the yui3-skin-sam class to the body so the default
    	// AutoComplete widget CSS skin will be applied to the form element.
        Y.one('form').addClass('yui3-skin-sam'); //Autocomplete css
        
        var geoname_base = "http://placenames.npolar.no:80";
        // Geoname service URI (JSONP service)
        // Use GET parameters ?location= and ?approved=true|false to change service URI
        // and thereby restricting results, e.g. /stadnamn/auto?location=Svalbard&approved=true
        var geoname_service = geoname_base + "/stadnamn/edge/{query}?callback={callback}&rows=5" + "&approved=true&amp;location=Svalbard&lang=nn";
        var geoname_autocomplete = Y.one('#geoname_autocomplete');
        geoname_autocomplete.plug(Y.Plugin.AutoComplete, {
            resultHighlighter : 'phraseMatch',
            //resultFormatter: simple_geoname_formatter,
            resultTextLocator : 'title',
            source : geoname_service
        });
        
        // zoom and add marker to the map when the user selects a place name from result 
        geoname_autocomplete.ac.on('select', function(e) {
        	//console.log(e.result.raw);
            WGS84ToUTM33(e);
            addMarker(position);
        })
    }); 
</code></pre>
					<p>The last function zooms and adds a graphic marker to the map when a user selects a place name from the result.</p>
					<p>Finally, create a <code>div</code> element above the map <code>div</code> to hold the search form and add an <code>input</code> element with the <code>geoname_autocomplete</code> id referenced in the YUI instance.</p>
					<pre><code>&lt;div id = "search" style="margin:10px 10% 0 10%; position: absolute; width: 250px; z-index: 2;"&gt;
	&lt;form action="" method="get"&gt;
		&lt;input type="search" id="geoname_autocomplete" value="" placeholder="Zoom to place name"/&gt;
	&lt;/form&gt;
&lt;/div&gt;</code></pre>

					<div id = "search" style="margin:10px 10% 0 10%; position: absolute; width: 250px; z-index: 2;">
						<form action="" method="get">
							<input type="search" id="geoname_autocomplete" value="" placeholder="Zoom to place name"/>
							<!-- link_to I18n.t("Nullstill") -->
						</form>
					</div>
					<div id="map" style="width:100%; height:256px; border:1px solid #000;"></div>

				</section>
				
				<!-- Map Overlays
				================================================== -->
		<section  id="overlays">
			<div class="page-header">
						<h2>Map Overlays</h2>
					</div>
					<p>The ArcGIS JavaScript API also alows to add or draw graphics such as markers, polylines, polygons, and popups into your map. 
						Those objects have location coordinates tied to them so that they can move when zooming or panning the map.</p>

					<h4>Points</h4>
					<h4>Polylines</h4>
					<h4>Polygons</h4>
		</section>
		
		<!-- Map Service Layers
				================================================== -->
		<section  id="layers"> <div class="page-header">
						<h2>Map Service Layers</h2>
					</div>
<ol>
  <li>In the "initialize" function, add the following line immediately before the end of the function: 
  	<pre><code>
var dynamicMap = new esri.arcgis.gmaps.DynamicMapServiceLayer("http://geodata.npolar.no/ArcGIS/rest/services/inspire3/Sj%C3%B8fuglKolonier/MapServer", null, 0.75, dynmapcallback); </code> </pre>
  	 
  	 This code creates a layer from a dynamic ArcGIS Server map service. To create the layer, you passed four arguments to the DynamicMapServiceLayer constructor:
    <ul>
      <li>The URL of the map service. The URL provided in this sample is from an ESRI sample server. You can replace it with the URL to one of your map services if you want. If you're not sure how to construct the URL to your map service, use the <a href="http://geodata.npolar.no/arcgis/rest/services">Services Directory</a> to discover it.</li>
      <li>Optional parameters to specify the image format (You left this as null).</li>
      <li>An opacity setting that determines how much you can see through the map. This is a value between 0 and 1. The closer to 0, the more you can see through the map. You used 0.75.</li>
      <li>A callback function. This is an optional function that runs once the map is created. You'll add code for this function (dynmapcallback) in the next step.</li>
    </ul>
    If you were writing this code without using the example, you could use the <a href="http://help.arcgis.com/en/webapi/javascript/gmaps/help/topics/apiref.htm">API Reference</a> to learn how to supply these parameters to the constructor.</li>
  <li>Although you've created the dynamic map service layer, you need to add it on top of the base map. You do this in the callback function. Remember from the previous step that we passed an argument to the DynamicMapServiceLayer constructor that was the name of this function (dynmapcallback). 
  	This function runs once the dynamic map has been created. The code in the callback function is what adds your ArcGIS Server map on top of Google Maps. Add the following in the header section below the "initialize" function:
    <div>
      <pre><code>
function dynmapcallback(mapservicelayer) {
	gmap.addOverlay(mapservicelayer);
	}  </code></pre>
    </div>
    Notice that this function has one argument, mapservicelayer, which represents the layer that you'll add to the map.</li>
  <li>Verify that your code matches the code below. Save the page and load it into a browser (double-click on the file in your file browser, or access it through your Web server's URL). You'll see the sample population density map over the Google Maps base map.</li>
</ol>
<p>

</p>	
	
	</section>

			</div>
		</div>
	</div>


<link href='http://fonts.googleapis.com/css?family=Open+Sans:800,700' rel='stylesheet' type='text/css'>
<script src="http://yui.yahooapis.com/3.10.1/build/yui/yui-min.js"></script>
<script src="/js/proj4js.min.js" type="text/javascript"></script>
<script type="text/javascript" src="http://serverapi.arcgisonline.com/jsapi/arcgis/3.5/"></script>
<script src="/js/npmaps.js" type="text/javascript"></script>

<script>
    YUI().use("autocomplete", "autocomplete-highlighters", function(Y) {
        Y.one('form').addClass('yui3-skin-sam');
        //Autocomplete css
        var geoname_base = "http://placenames.npolar.no:80";
        // Geoname service URI (JSONP service)
        var geoname_service = geoname_base + "/stadnamn/edge/{query}?callback={callback}&rows=5" + "&approved=true&location=Svalbard&lang=nn";
        var geoname_autocomplete = Y.one('#geoname_autocomplete');
        geoname_autocomplete.plug(Y.Plugin.AutoComplete, {
            resultHighlighter : 'phraseMatch',
            //resultFormatter: simple_geoname_formatter,
            resultTextLocator : 'title',
            source : geoname_service
        });
        
        // zoom and add marker to the place name when the user selects from result 
        geoname_autocomplete.ac.on('select', function(e) {
        	//console.log(e.result.raw);
            WGS84ToUTM33(e);
            addMarker(position);
        })
    }); 
</script>
<script type="text/javascript">
    dojo.require("esri.map");

    var map;

    function initialize() {
    	
      	var initialExtent = new esri.geometry.Extent({"xmin": 477423.89,"ymin":8663685.98,"xmax":553624.05,"ymax":8714486.09,"spatialReference":{"wkid":32633}});
      	// create map instance and add a basemap
        map = new esri.Map("map", {extent: initialExtent, logo : false});
        
        basemapURL = "http://geodata.npolar.no/ArcGIS/rest/services/inspire1/NP_TopoSvalbard_U33_CHL/MapServer"
		map.addLayer(new esri.layers.ArcGISTiledMapServiceLayer(basemapURL));
				
        //add marker for place names search result to map
        graphicLayer = new esri.layers.GraphicsLayer();
        map.addLayer(graphicLayer);       
        graphicLayer.show();

        var map1 = new esri.Map("map1", {extent: initialExtent, logo : false});
        map1.addLayer(new esri.layers.ArcGISTiledMapServiceLayer(basemapURL));
    }

    dojo.ready(initialize); 
</script>
</body>
</html>